<div class="container">
  <svg class="background-symbol" xmlns="http://www.w3.org/2000/svg" width="1294" height="1078" fill="none" viewBox="0 0 1294 1078">
    <path fill="#fff" fill-opacity=".01" d="m1061.06 537.856-25.9 19.173a26.403 26.403 0 0 1-14.34 5.366c-5.2.334-10.39-.878-14.9-3.486a26.424 26.424 0 0 1-12.995-26.266l3.653-32.018a227.673 227.673 0 0 0-41.648-159.711l-25.472-35.147a27.676 27.676 0 0 1 25.143-43.548l40.752 4.294a228.204 228.204 0 0 0 162.527-46.415l27.39-21.025a26.412 26.412 0 0 1 29.68-2.223 26.466 26.466 0 0 1 10.6 11.417 26.46 26.46 0 0 1 2.32 15.401l-4.49 34.191a228.236 228.236 0 0 0 41 163.976l24.11 33.217a27.633 27.633 0 0 1 5.03 14.692 27.756 27.756 0 0 1-3.68 15.086 27.676 27.676 0 0 1-11.23 10.729 27.657 27.657 0 0 1-15.23 2.996l-43.2-4.558a227.683 227.683 0 0 0-159.12 43.859ZM665.267.146 891.376 130.69l-52.217 90.444-135.666-78.327-313.306 542.662a208.87 208.87 0 1 1-234.912-306.232 208.866 208.866 0 0 1 234.935 97.321L665.267.146Zm222.384 763.609 66.186-114.637 90.443 52.217-156.653 271.331a208.888 208.888 0 0 1-100.97 88.514 208.963 208.963 0 0 1-133.987 8.76 208.896 208.896 0 0 1-111.633-74.62 208.868 208.868 0 0 1 .029-254.296 208.866 208.866 0 0 1 346.585 22.731Zm-730.569-92.277a104.437 104.437 0 0 0 142.661-38.226 104.436 104.436 0 1 0-142.661 38.226Zm497.44 287.197a104.435 104.435 0 1 0 104.435-180.886 104.435 104.435 0 0 0-104.435 180.886Z"/>
  </svg>

  <header>
    <h1>
      sta
      <svg xmlns="http://www.w3.org/2000/svg" width="27" height="27" fill="none" viewBox="0 0 27 27">
        <path fill="url(#a)" d="m15.712 23.764-.82 1.886a1.687 1.687 0 0 1-3.114 0l-.82-1.886a14.533 14.533 0 0 0-7.4-7.5l-2.53-1.13a1.766 1.766 0 0 1 0-3.21l2.39-1.064a14.567 14.567 0 0 0 7.504-7.753l.843-2.037a1.687 1.687 0 0 1 3.14 0l.843 2.034a14.567 14.567 0 0 0 7.5 7.756l2.394 1.067a1.767 1.767 0 0 1 0 3.207l-2.534 1.126a14.533 14.533 0 0 0-7.396 7.504Z"/>
        <defs>
          <linearGradient id="a" x1="0" x2="27" y1="66.667" y2="66.667" gradientUnits="userSpaceOnUse">
            <stop stop-color="#7A1EC9"/>
            <stop offset="1" stop-color="#236CFD"/>
          </linearGradient>
        </defs>
      </svg>
    </h1>

    <h2>simply tag audio</h2>
  </header>

  <div
    class="main-container"
    (dragover)="onDragOver($event)"
    (dragleave)="onDragLeave($event)"
    (drop)="onDrop($event)"
    (click)="onInputClick()"
    [class.droppable]="isDragging"
    [class.active]="requestStarted"
  >
    <input
      #fileInput
      type="file"
      multiple
      accept=".mp3"
      (change)="onInputSelect($event)"
    />

    <main>
      <svg width="71" height="67" viewBox="0 0 71 67" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M20.3335 6.99997H37.0002V13.6666H27.0002V53.6666C26.9995 56.6016 26.0305 59.4544 24.2433 61.7825C22.4561 64.1107 19.9507 65.7841 17.1156 66.5432C14.2805 67.3024 11.2741 67.1049 8.56267 65.9813C5.85125 64.8578 3.58631 62.871 2.11909 60.329C0.651882 57.7871 0.0643913 54.832 0.44773 51.9222C0.831069 49.0123 2.16382 46.3103 4.23929 44.235C6.31476 42.1598 9.01697 40.8273 11.9269 40.4443C14.8368 40.0613 17.7917 40.6491 20.3335 42.1166V6.99997ZM57.0002 42.1166V33.6666H63.6669V53.6666C63.6662 56.6016 62.6971 59.4544 60.91 61.7825C59.1228 64.1107 56.6174 65.7841 53.7823 66.5432C50.9472 67.3024 47.9408 67.1049 45.2293 65.9813C42.5179 64.8578 40.253 62.871 38.7858 60.329C37.3186 57.7871 36.7311 54.832 37.1144 51.9222C37.4977 49.0123 38.8305 46.3103 40.906 44.235C42.9814 42.1598 45.6836 40.8273 48.5935 40.4443C51.5034 40.0613 54.4584 40.6491 57.0002 42.1166ZM13.6668 60.3333C15.435 60.3333 17.1307 59.6309 18.3809 58.3807C19.6311 57.1304 20.3335 55.4347 20.3335 53.6666C20.3335 51.8985 19.6311 50.2028 18.3809 48.9526C17.1307 47.7024 15.435 47 13.6668 47C11.8987 47 10.203 47.7024 8.9528 48.9526C7.70256 50.2028 7.00018 51.8985 7.00018 53.6666C7.00018 55.4347 7.70256 57.1304 8.9528 58.3807C10.203 59.6309 11.8987 60.3333 13.6668 60.3333ZM50.3335 60.3333C52.1016 60.3333 53.7973 59.6309 55.0476 58.3807C56.2978 57.1304 57.0002 55.4347 57.0002 53.6666C57.0002 51.8985 56.2978 50.2028 55.0476 48.9526C53.7973 47.7024 52.1016 47 50.3335 47C48.5654 47 46.8697 47.7024 45.6195 48.9526C44.3692 50.2028 43.6669 51.8985 43.6669 53.6666C43.6669 55.4347 44.3692 57.1304 45.6195 58.3807C46.8697 59.6309 48.5654 60.3333 50.3335 60.3333Z" fill="url(#paint0_linear_2019_22)"/>
        <path d="M59.3767 24.0933L58.5567 25.98C58.4286 26.2872 58.2124 26.5496 57.9354 26.7342C57.6584 26.9188 57.3329 27.0173 57.0001 27.0173C56.6672 27.0173 56.3418 26.9188 56.0648 26.7342C55.7877 26.5496 55.5716 26.2872 55.4434 25.98L54.6234 24.0933C53.1817 20.7557 50.5413 18.0797 47.2234 16.5933L44.6934 15.4633C44.3865 15.3221 44.1265 15.0959 43.9442 14.8114C43.7619 14.5269 43.665 14.1962 43.665 13.8583C43.665 13.5205 43.7619 13.1897 43.9442 12.9052C44.1265 12.6207 44.3865 12.3945 44.6934 12.2533L47.0834 11.19C50.4847 9.66125 53.1703 6.88625 54.5867 3.43665L55.4301 1.39998C55.5539 1.0845 55.77 0.813642 56.05 0.622732C56.3301 0.431822 56.6611 0.329712 57.0001 0.329712C57.339 0.329712 57.6701 0.431822 57.9501 0.622732C58.2302 0.813642 58.4462 1.0845 58.5701 1.39998L59.4134 3.43332C60.8284 6.88357 63.5127 9.65976 66.9134 11.19L69.3067 12.2566C69.6127 12.3982 69.8718 12.6245 70.0534 12.9086C70.235 13.1927 70.3315 13.5228 70.3315 13.86C70.3315 14.1972 70.235 14.5273 70.0534 14.8114C69.8718 15.0955 69.6127 15.3217 69.3067 15.4633L66.7734 16.59C63.4561 18.0779 60.817 20.7551 59.3767 24.0933Z" fill="url(#paint1_linear_2019_22)"/>
        <defs>
          <linearGradient id="paint0_linear_2019_22" x1="1.44992e-08" y1="66.997" x2="70" y2="66.997" gradientUnits="userSpaceOnUse">
            <stop stop-color="#7A1EC9"/>
            <stop offset="1" stop-color="#236CFD"/>
          </linearGradient>
          <linearGradient id="paint1_linear_2019_22" x1="44" y1="66.997" x2="70" y2="66.997" gradientUnits="userSpaceOnUse">
            <stop stop-color="#7A1EC9"/>
            <stop offset="1" stop-color="#236CFD"/>
          </linearGradient>
        </defs>
      </svg>

      <h3>
        @if (requestStarted) {
          Processing files...
        } @else if (isFirstRequest) {
          Drop your mp3 files here
        } @else {
          Drop more mp3 files here
        }
      </h3>

      <p>No files are uploaded to our server. Only the filenames are processed by GPT-4o mini to extract the artist and title.</p>
    </main>
  </div>

  @if (!requestStarted) {
    @if (issueMessage) {
      <span class="issue-message">{{ issueMessage }}</span>
    }

    <section>
      @if (files.length > 1) {
        <button [disabled]="isDownloadingAll" class="all-download" (click)="downloadAll()">
          @if (isDownloadingAll) {
            Downloading...
          } @else {
            Download all
          }
        </button>
      }

      @for (file of files; track file; let index = $index) {
        <div class="file-container">
          <div class="file-names">
            <span class="file-old-name">{{ file.original_name }}</span>
            <span class="file-new-name">{{ buildName(file)}}<small>.mp3</small></span>
          </div>
          <div class="file-actions">
            <div class="file-switcher" (click)="swapArtistTitle(file)">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="18" fill="none" viewBox="0 0 20 18">
                <path stroke="#484B51" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 5 5 1m0 0L1 5m4-4v16m6-4 4 4m0 0 4-4m-4 4V1"/>
              </svg>
            </div>
            <div class="file-tags">
              <div class="file-artist"><label for="{{ index }}-artist">Artist</label> <input placeholder="Add Artist" name="{{ index }}-artist" id="{{ index }}-artist" [(ngModel)]="file.artist"></div>
              <div class="file-title"><label for="{{ index }}-title">Title</label> <input placeholder="Add Title" name="{{ index }}-title" id="{{ index }}-title" [(ngModel)]="file.title"></div>
            </div>
            <div class="file-download" [class.downloaded]="file.downloaded" (click)="downloadFile(file)">
              <svg class="downloaded-icon" xmlns="http://www.w3.org/2000/svg" width="30" height="21" fill="none" viewBox="0 0 30 21">
                <path fill="#484B51" fill-rule="evenodd" d="M28.51.641a2.188 2.188 0 0 1 0 3.093L12.114 20.13a2.333 2.333 0 0 1-3.3 0L.668 11.986A2.188 2.188 0 1 1 3.76 8.892l6.702 6.703L25.416.641a2.188 2.188 0 0 1 3.094 0Z" clip-rule="evenodd"/>
              </svg>
              <svg class="download-icon" xmlns="http://www.w3.org/2000/svg" width="23" height="27" fill="none" viewBox="0 0 23 27">
                <path fill="#484B51" fill-rule="evenodd" d="M22.216 14.145a2.048 2.048 0 0 1-.033 2.9l-9.225 9.02a2.05 2.05 0 0 1-2.866 0l-9.225-9.02a2.05 2.05 0 1 1 2.866-2.93l5.742 5.614V2.05a2.05 2.05 0 0 1 4.1 0v17.68l5.74-5.616a2.048 2.048 0 0 1 2.901.033v-.002Z" clip-rule="evenodd"/>
              </svg>
            </div>
          </div>
        </div>
      }
    </section>

    @if (files.length > 4) {
      <button [disabled]="isDownloadingAll" class="all-download" (click)="downloadAll()">
        @if (isDownloadingAll) {
          Downloading...
        } @else {
          Download all
        }
      </button>
    }
  }

  <footer>
    <a href="https://github.com/devfake/sta" target="_blank">The code is open source on <svg xmlns="http://www.w3.org/2000/svg" width="19" height="23" fill="none" viewBox="0 0 19 23">
      <path fill="#484B51" d="M4.315 5.176c-.25-.638-.24-1.367-.129-2.034a6.8 6.8 0 0 1 2.12 1.07c.28.214.647.283.99.18A9.3 9.3 0 0 1 10 4c.961 0 1.874.14 2.703.391.342.104.71.034.988-.18a6.8 6.8 0 0 1 2.12-1.07c.11.667.12 1.396-.129 2.033-.15.384-.075.826.208 1.14C16.614 7.117 17 8.04 17 9c0 2.114-1.97 4.187-5.134 4.818-.792.158-1.1 1.155-.495 1.726.39.366.63.882.63 1.456v3a1 1 0 0 0 2 0v-3c0-.57-.12-1.112-.335-1.603C16.683 14.35 19 11.993 19 9c0-1.347-.484-2.585-1.287-3.622.21-.82.191-1.646.111-2.28-.07-.568-.17-1.312-.57-1.756-.595-.659-1.58-.271-2.28-.032a9 9 0 0 0-2.125 1.045A11.4 11.4 0 0 0 10 2c-.994 0-1.953.125-2.85.356a9 9 0 0 0-2.126-1.045c-.7-.24-1.686-.628-2.28.031-.409.452-.494 1.137-.567 1.719l-.005.038c-.08.635-.098 1.462.112 2.283C1.484 6.418 1 7.654 1 9c0 2.992 2.317 5.35 5.334 6.397A4 4 0 0 0 6 16.98l-.168.034c-.717.099-1.176.01-1.488-.122-.76-.322-1.152-1.133-1.63-1.753-.298-.385-.732-.866-1.398-1.088a1.001 1.001 0 0 0-.632 1.898c.558.186.944 1.142 1.298 1.566.373.448.87.916 1.58 1.218.682.29 1.483.393 2.438.276V20a1 1 0 1 0 2 0v-3c0-.574.24-1.09.63-1.456.606-.572.296-1.568-.496-1.726C4.97 13.187 3 11.114 3 9c0-.958.385-1.881 1.108-2.684.283-.314.357-.756.207-1.14Z"/>
    </svg>
      GitHub</a>
  </footer>
</div>

